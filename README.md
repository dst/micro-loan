# micro-loan
[![Build Status](https://travis-ci.org/dst/micro-loan.svg)](https://travis-ci.org/dst/micro-loan)
[![Coverage Status](https://coveralls.io/repos/dst/micro-loan/badge.png)](https://coveralls.io/r/dst/micro-loan)

RESTful web service for micro loans.

## System dependencies
- Java 8

## Configuration
Default port is 8888. It can be changed in application.properties if needed.

## Starting server
For Windows use gradlew.bat

### Run from gradle
    ./gradlew bootRun

### Run the fat jar
    java -jar build/libs/micro-loan.jar

## Verification
    $ curl localhost:8888/info
    {
      "app": {
        "version":"0.1",
        "name": "micro-loan",
        "description": "RESTful web service for micro loans"
      },
      "git": {
        "branch": "master",
        "commit": {
          "id": "b5888b5",
          "time": "'Sun Jun 15 22:24:35 2014 +0200'"
        }
      }
    }

## Technology stack
- back-end: Java 8, Spring Boot, Spring Data, JPA with Hibernate, embedded H2 Database, Lombok, Logback
- testing: JUnit 4, mockito, AssertJ, MockMvc, Cucumber, Groovy, Spock
- building/deploying: embedded Apache Tomcat, gradle, Heroku
- code metrics: JaCoCo

## REST API documentation
Documentation is generated by Swagger and is available under / suffix.
For local run it can be found at http://localhost:8888/

## Example session with server
Server accepts and returns only JSON. -v can be used for verbose output.

### Customer creates account
    $ curl -H "Content-Type: application/json" -d '{"firstName":"Jan", "lastName":"Kowalski"}' localhost:8888/customers
    {"id":1}

### Customer views his account
    $ curl localhost:8888/customers/1
    {
        "id":1,
        "firstName":"Jan",
        "lastName":"Kowalski"
    }

### Customer loans 1000 PLN for 30 days (first loan)
    $ curl -H "Content-Type: application/json" -d '{"customerId": 1, "amount": 1000.00, "daysCount": 30}' localhost:8888/loans
    {"id":1}

### Customer views first loan
    $ curl localhost:8888/loans/1
    {
        "id":1,
        "amount":1000.00,
        "interest":9.00,
        "extensions":[],
        "start":"2014-06-14",
        "end":"2014-07-14"
    }
    
### Customer extends first loan
    $ curl -H "Content-Type: application/json" -d '{}' localhost:8888/loans/1/extensions
    {"id":1}
    
### Customer views first loan with extension
Interest was multiplied by 1.5 and deadline was extended by 7 days.

    $ curl localhost:8888/loans/1
    {
        "id":1,
        "amount":1000.00,
        "interest":13.50,
        "extensions":[
            {
                "id":1,
                "creationTime":"2014-06-14"
            }
        ],
        "start":"2014-06-14",
        "end":"2014-07-21"}

### Customer views extension
    $ curl localhost:8888/loans/1/extensions/1
    {
        "id":1,
        "creationTime":"2014-06-14"
    }

### Customer loans 500.50 PLN for 15 days (second loan)
    $ curl -H "Content-Type: application/json" -d '{"customerId": 1, "amount": 500.50, "daysCount": 15}' localhost:8888/loans
    {"id":2}

### Customer views all his loans
    $ curl localhost:8888/loans?customerId=1
    [
        {
            "id":1,
            "amount":1000.00,
            "interest":13.50,
            "extensions":[
                {
                    "id":1,
                    "creationTime":"2014-06-14"
                }
             ],
             "start":"2014-06-14",
             "end":"2014-07-21"
         },
         {
            "id":2,
            "amount":500.50,
            "interest":9.00,
            "extensions":[],
            "start":"2014-06-14",
            "end":"2014-06-29"
         }
    ]

## Heroku deployment
Automatic deployment is possible for Heroku users, but please be aware that "1x standard dyno"
has not enough RAM and CPU to start micro-loan app in 60 seconds (boot timeout).
PX dyno should be used instead.

- Copy gradle.properties.example to gradle.properties
    - Set api key
    - Set app name
- Create app: $ ./gradlew herokuAppCreate
- Deploy app: ./gradlew herokuAppDeploy (or "git push heroku master" to be more aware what is going on)
- Check logs: heroku logs -t
- RESTful web service waits to serve your requests at address http://your-app-name.herokuapp.com

## Possible extensions
- Currency (PLN, USD, etc.)
- JSON/XML negotiation
- HATEOAS
- I18N for error messages
- Configuration reloading on demand
- CQRS

## Known issues
- Required info and description in model are missing in Swagger doc, because ApiModelProperty is not yet implemented
( https://github.com/martypitt/swagger-springmvc/issues/281 ). Response model is also not available (@ApiResponse, response). 
- Git info is not available at Heroku.

## Disclaimer
All Spring Boot Actuator endpoints are turn on and are available at server port. It is convenience when testing,
but not recommended in production.
